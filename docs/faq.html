<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>FAQ · Cats Effect</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Scala CLI"/><meta name="docsearch:version" content="3.x"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="FAQ · Cats Effect"/><meta property="og:type" content="website"/><meta property="og:url" content="https://typelevel.org/cats-effect/"/><meta property="og:description" content="## Scala CLI"/><meta property="og:image" content="https://typelevel.org/cats-effect/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://typelevel.org/cats-effect/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/cats-effect/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github-gist.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/cats-effect/js/scrollSpy.js"></script><link rel="stylesheet" href="/cats-effect/css/main.css"/><script src="/cats-effect/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/cats-effect/"><img class="logo" src="/cats-effect/img/cats-effect-logo.svg" alt="Cats Effect"/><h2 class="headerTitleWithLogo">Cats Effect</h2></a><a href="/cats-effect/versions"><h3>3.x</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/cats-effect/docs/getting-started" target="_self">Docs</a></li><li class=""><a href="/cats-effect/api/3.x/cats/effect/index.html" target="_self">API</a></li><li class=""><a href="https://github.com/typelevel/cats-effect" target="_blank">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Overview</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Overview<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cats-effect/docs/getting-started">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/concepts">Concepts</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/tutorial">Tutorial</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/recipes">Recipes</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/cats-effect/docs/faq">FAQ</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/migration-guide">Migration Guide</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/third-party-resources">Third-Party Learning Resources</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Core Runtime<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cats-effect/docs/core/test-runtime">Test Runtime</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/core/fiber-dumps">Fiber Dumps</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/tracing">Tracing</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/thread-model">Thread Model</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/schedulers">Schedulers</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/core/starvation-and-tuning">Starvation and Tuning</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/core/io-runtime-config">IORuntime Configuration</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/core/native-image">GraalVM Native Image</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/core/scala-native">Scala Native</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/core/jlink">Jlink image</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/core/io-local">IOLocal</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Typeclasses<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cats-effect/docs/typeclasses">Overview</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/typeclasses/monadcancel">MonadCancel</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/typeclasses/spawn">Spawn</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/typeclasses/unique">Unique</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/typeclasses/clock">Clock</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/typeclasses/concurrent">Concurrent</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/typeclasses/temporal">Temporal</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/typeclasses/sync">Sync</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/typeclasses/async">Async</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Standard Library<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/atomic-cell">Atomic Cell</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/backpressure">Backpressure</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/console">Console</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/countdown-latch">Count Down Latch</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/cyclic-barrier">Cyclic Barrier</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/deferred">Deferred</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/dequeue">Dequeue</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/dispatcher">Dispatcher</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/env">Env</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/hotswap">Hotswap</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/mutex">Mutex</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/pqueue">Priority Queue</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/queue">Queue</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/random">Random</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/ref">Ref</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/resource">Resource</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/semaphore">Semaphore</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/supervisor">Supervisor</a></li><li class="navListItem"><a class="navItem" href="/cats-effect/docs/std/async-await">Async/Await (Experimental)</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">FAQ</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="scala-cli"></a><a href="#scala-cli" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scala CLI</h2>
<p><a href="https://scala-cli.virtuslab.org/">Scala CLI</a> can run both <code>.sc</code> files and <code>.scala</code> files. <code>.sc</code> files allow definitions at the top level and a main method is synthesized to run it. Unfortunately this does not work well with <code>IO#unsafeRunSync</code>. You should put your cats-effect code inside the <code>run</code> method of an <code>IOApp</code> and save it as a <code>.scala</code> file instead.</p>
<pre><code class="hljs css language-scala-cli"><span class="hljs-comment">//&gt; using scala "2.13.8"</span>
<span class="hljs-comment">//&gt; using lib "org.typelevel::cats-effect::3.4.11"</span>

<span class="hljs-keyword">import</span> cats.effect._

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">HelloWorld</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">IOApp</span>.<span class="hljs-title">Simple</span> </span>{
  <span class="hljs-keyword">val</span> run: <span class="hljs-type">IO</span>[<span class="hljs-type">Unit</span>] = <span class="hljs-type">IO</span>.println(<span class="hljs-string">"Hello world"</span>)
}
</code></pre>
<pre><code class="hljs css language-sh">$ scala-cli Hello.scala
Hello world
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="native-image-example"></a><a href="#native-image-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Native Image Example</h3>
<p><a href="https://scala-cli.virtuslab.org/">Scala CLI</a> can be leveraged to produce a native-image executable using the <a href="https://scala-cli.virtuslab.org/docs/commands/package#native-image">package command</a>:</p>
<pre><code class="hljs css language-sh">$ scala-cli package --native-image --graalvm-version 22.1.0 -f Hello.scala -- --no-fallback
[...]
$ ./HelloWorld
Hello world
</code></pre>
<blockquote>
<p>Note: GraalVm Native Image &gt; 21.0.0 and <code>--no-fallback</code> are mandatory: see <a href="/cats-effect/docs/core/native-image">here</a> for details</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="scala-native-example"></a><a href="#scala-native-example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scala Native Example</h3>
<p><a href="https://scala-cli.virtuslab.org/">Scala CLI</a> can be leveraged to produce a <a href="https://github.com/scala-native/scala-native">Scala Native</a> executable using the <a href="https://scala-cli.virtuslab.org/docs/commands/package/#scala-native">package command</a>:</p>
<pre><code class="hljs css language-sh">$ scala-cli package --native Hello.scala
[...]
$ ./HelloWorld
Hello world
</code></pre>
<p>See <a href="/cats-effect/docs/core/scala-native">here</a> for details.</p>
<h2><a class="anchor" aria-hidden="true" id="how-can-i-loop-over-a-collection-inside-of-io"></a><a href="#how-can-i-loop-over-a-collection-inside-of-io" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How can I loop over a collection inside of <code>IO</code>?</h2>
<p><code>traverse</code>!</p>
<p>The <code>traverse</code> method is, in some sense, Cats' equivalent of <code>foreach</code>, but much more powerful in that it allows each iteration of the loop to be wrapped in an effect (such as <code>IO</code>) and can produce a value. This also allows it to generalize nicely to run operations in parallel, with the <code>parTraverse</code> method.</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> cats.effect._
<span class="hljs-keyword">import</span> cats.syntax.all._

<span class="hljs-keyword">val</span> names = <span class="hljs-type">List</span>(<span class="hljs-string">"daniel"</span>, <span class="hljs-string">"chris"</span>, <span class="hljs-string">"joseph"</span>, <span class="hljs-string">"renee"</span>, <span class="hljs-string">"bethany"</span>, <span class="hljs-string">"grace"</span>)
<span class="hljs-keyword">val</span> program: <span class="hljs-type">IO</span>[<span class="hljs-type">List</span>[<span class="hljs-type">Unit</span>]] = names.traverse(name =&gt; <span class="hljs-type">IO</span>.println(<span class="hljs-string">s"Hi, <span class="hljs-subst">$name</span>!"</span>))
</code></pre>
<p>In the above example, <code>traverse</code> will iterate over every element of the <code>List</code>, running the function <code>String =&gt; IO[Unit]</code> which it was passed, assembling the results into a resulting <code>List</code> wrapped in a single outer <code>IO</code>, preserving the order of the original input list.</p>
<blockquote>
<p>You <em>must</em> have <code>import cats.syntax.all._</code> (or <code>import cats.syntax.traverse._</code>) in scope, otherwise this will not work! <code>traverse</code> is a method that is implicitly enriched onto collections like <code>List</code>, <code>Vector</code>, and such, meaning that it must be brought into scope using an import (unfortunately!).</p>
</blockquote>
<p>Of course, in the above example, we don't really care about the results, since our <code>IO</code> is constantly producing <code>Unit</code>. This pattern is so common that we have a special combinator for it: <code>traverse_</code>.</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> cats.effect._
<span class="hljs-keyword">import</span> cats.syntax.all._

<span class="hljs-keyword">val</span> names = <span class="hljs-type">List</span>(<span class="hljs-string">"daniel"</span>, <span class="hljs-string">"chris"</span>, <span class="hljs-string">"joseph"</span>, <span class="hljs-string">"renee"</span>, <span class="hljs-string">"bethany"</span>, <span class="hljs-string">"grace"</span>)
<span class="hljs-keyword">val</span> program: <span class="hljs-type">IO</span>[<span class="hljs-type">Unit</span>] = names.traverse_(name =&gt; <span class="hljs-type">IO</span>.println(<span class="hljs-string">s"Hi, <span class="hljs-subst">$name</span>!"</span>))
</code></pre>
<p>This efficiently discards the results of each <code>IO</code> (which are all <code>()</code> anyway), producing a single <code>IO[Unit]</code> at the end.</p>
<p>This type of pattern generalizes extremely well, both to actions which <em>do</em> return results, as well as to more advanced forms of execution, such as parallelism. For example, let's define and use a <code>fetchUri</code> method which uses <a href="https://http4s.org">Http4s</a> to load the contents of a URI. We will then iterate over our list of <code>names</code> <em>in parallel</em>, fetching all of the contents into a single data structure:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> cats.effect._
<span class="hljs-keyword">import</span> cats.syntax.all._

<span class="hljs-keyword">import</span> org.http4s.ember.client.<span class="hljs-type">EmberClientBuilder</span>

<span class="hljs-comment">// just as an example...</span>
<span class="hljs-keyword">val</span> <span class="hljs-type">Prefix</span> = <span class="hljs-string">"https://www.scb.se/en/finding-statistics/sverige-i-siffror/namesearch/Search/?nameSearchInput="</span>
<span class="hljs-keyword">val</span> <span class="hljs-type">Extract</span> = <span class="hljs-string">""</span><span class="hljs-string">"(\d+(?:\s*\d+)*) persons"</span><span class="hljs-string">""</span>.r

<span class="hljs-keyword">val</span> names = <span class="hljs-type">List</span>(<span class="hljs-string">"daniel"</span>, <span class="hljs-string">"chris"</span>, <span class="hljs-string">"joseph"</span>, <span class="hljs-string">"renee"</span>, <span class="hljs-string">"bethany"</span>, <span class="hljs-string">"grace"</span>)

<span class="hljs-keyword">val</span> program: <span class="hljs-type">IO</span>[<span class="hljs-type">Unit</span>] = <span class="hljs-type">EmberClientBuilder</span>.<span class="hljs-keyword">default</span>[<span class="hljs-type">IO</span>].build use { client =&gt;
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fetchUri</span></span>(uri: <span class="hljs-type">String</span>): <span class="hljs-type">IO</span>[<span class="hljs-type">String</span>] = client.expect[<span class="hljs-type">String</span>](uri)

  <span class="hljs-keyword">val</span> counts: <span class="hljs-type">List</span>[(<span class="hljs-type">String</span>, <span class="hljs-type">Int</span>)] = names parTraverse { name =&gt;
    fetchUri(<span class="hljs-type">Prefix</span> + name) map { body =&gt;
      <span class="hljs-keyword">val</span> <span class="hljs-type">Extract</span>(countStr) = body  <span class="hljs-comment">// who needs html parsing?</span>
      name -&gt; countStr.toInt
    }
  }

  counts.traverse_(<span class="hljs-type">IO</span>.println(_))
}
</code></pre>
<p>The above <code>program</code> creates a new HTTP client (with associated connection pooling and other production configurations), then <em>in parallel</em> iterates over the list of names, constructs a search URL for each name, runs an HTTP <code>GET</code> on that URL, &quot;parses&quot; the contents using a naive regular expression extracting the count of persons who have that given name, and produces the results of the whole process as a <code>List[(String, Int)]</code>. Then, given this list of <code>counts</code>, we <em>sequentially</em> iterate over the results and print out each tuple. Finally, we fully clean up the client resources (e.g. closing the connection pool). If any of the HTTP <code>GET</code>s produces an error, all resources will be closed and the remaining connections will be safely terminated.</p>
<p>Note that, as with <code>traverse</code> itself, <code>parTraverse</code> preserves the order of the input list even though it evaluates the individual <code>IO</code>s in parallel.</p>
<p>In general, any time you have a problem where you have a collection, <code>Struct[A]</code> and an <em>effectful</em> function <code>A =&gt; IO[B]</code> and your goal is to get an <code>IO[Struct[B]]</code>, the answer is going to be <code>traverse</code>. This works for almost any definition of <code>Struct</code> that you can think of! For example, you can do this for <code>Option[A]</code> as well. You can even enable this functionality for custom structures by defining an instance of the <a href="https://typelevel.org/cats/typeclasses/traverse.html"><code>Traverse</code> typeclass</a> for your custom datatype (hint: most classes or algebras which have a shape like <code>Struct[A]</code> where they <em>contain a value of type <code>A</code></em> can easily implement <code>Traverse</code>).</p>
<h2><a class="anchor" aria-hidden="true" id="why-is-my-io-running-on-a-blocking-thread"></a><a href="#why-is-my-io-running-on-a-blocking-thread" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Why is my <code>IO(...)</code> running on a blocking thread?</h2>
<p>Cats Effect guarantees that <code>IO.blocking(...)</code> will run on a blocking thread. However, in many situations it may also run a non-blocking operation <code>IO(...)</code> (or <code>IO.delay(...)</code>) on a blocking thread. Do not be alarmed! This is an optimization.</p>
<p>Consider the following program:</p>
<pre><code class="hljs css language-scala"><span class="hljs-type">IO</span>.blocking(...) *&gt; <span class="hljs-type">IO</span>(...) *&gt; <span class="hljs-type">IO</span>.blocking(...)
</code></pre>
<p>If the <code>IO(...)</code> in the middle was run on the compute pool this would require:</p>
<ol>
<li>requisitioning a blocking thread, and running the first blocking op</li>
<li>shifting back to the compute pool, for the non-blocking op</li>
<li>requisitioning another blocking thread, for the second blocking op</li>
</ol>
<p>So in this case, the intermediate <code>IO(...)</code> is highly likely to run on a blocking thread. This enables the entire sequence to run on the same blocking thread, without any shifting. As soon as any asynchronous operation (or an auto-cede boundary) is encountered, the fiber will be shifted back to a compute thread. The tradeoff here is to create a small amount of unnecessary thread contention in exchange for avoiding unnecessary context shifts in many cases.</p>
<p>Note that this is just a specific example to demonstrate why running an non-blocking <code>IO(...)</code> on a blocking thread can be beneficial, but it is not the only situation in which you may observe this behavior.</p>
<h2><a class="anchor" aria-hidden="true" id="dealing-with-starvation"></a><a href="#dealing-with-starvation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dealing with Starvation</h2>
<p>Cats Effect 3.4.0 introduced a default-enabled <em>starvation checker</em>, which produces warnings like the following:</p>
<pre><code class="hljs">2023-01-28T00:16:24.101Z [WARNING] Your app's responsiveness to a new asynchronous
event (such as a new connection, an upstream response, or a timer) was in excess
of 40 milliseconds. Your CPU is probably starving. Consider increasing the
granularity of your delays or adding more cedes. This may also be a sign that you
are unintentionally running blocking I/O operations (such as File or InetAddress)
without the blocking combinator.
</code></pre>
<p>If you're seeing this warning and have not changed any of the default configurations, it means that your application is taking at least <em>100 milliseconds</em> to respond to an external asynchronous event. In this case, the runtime is measuring this fact using a timer, but external events are also things such as new connections, request bodies, upstream responses, and such. In other words, <strong>if you're seeing this warning, it means your response latencies are <em>at least</em> this long.</strong></p>
<ul>
<li>If this level of application performance is not within acceptable bounds, please see the <a href="/cats-effect/docs/core/starvation-and-tuning">starvation and tuning</a> documentation for more discussion on how you can resolve the issue</li>
<li>If 100 milliseconds is acceptable for your use-case, but you would still like to preserve checking with some higher time-bound, you can adjust this by overriding the <code>cpuStarvationCheckInterval</code> (default: <code>1.second</code>) in <code>IORuntimeConfig</code>. The threshold coefficient itself (default: <code>0.1d</code>) is configurable via <code>cpuStarvationCheckThreshold</code>, but it is generally best practice to tune the interval rather than the threshold. Increasing the interval increases the absolute threshold proportionally (e.g. setting the interval to <code>2.seconds</code> would change the warning cutoff to 200 milliseconds)</li>
<li>If you would like to entirely disable this check, you can do so by overriding the <code>cpuStarvationCheckInitialDelay</code> value within <code>IORuntimeConfig</code> to <code>Duration.Inf</code></li>
</ul>
<p>Please understand that this warning is essentially never a false negative. Outside of some extremely rare circumstances, it accurately measures the responsiveness of your application runtime. However, as a corollary of this accuracy, it is measuring not only your application runtime, but also the system (and other adjacent processes on that system) on which your application is running. Thus, if you see this warning, it essentially always means that either the checker's definition of &quot;responsiveness&quot; (100 millisecond SLA) is different from what you expected, or it means that there is some legitimate problem <em>somewhere</em> in your application, your JVM, your kernel, your host environment, or all of the above.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/cats-effect/docs/recipes"><span class="arrow-prev">← </span><span>Recipes</span></a><a class="docs-next button" href="/cats-effect/docs/migration-guide"><span>Migration Guide</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#scala-cli">Scala CLI</a><ul class="toc-headings"><li><a href="#native-image-example">Native Image Example</a></li><li><a href="#scala-native-example">Scala Native Example</a></li></ul></li><li><a href="#how-can-i-loop-over-a-collection-inside-of-io">How can I loop over a collection inside of <code>IO</code>?</a></li><li><a href="#why-is-my-io-running-on-a-blocking-thread">Why is my <code>IO(...)</code> running on a blocking thread?</a></li><li><a href="#dealing-with-starvation">Dealing with Starvation</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/cats-effect/" class="nav-home"><img src="/cats-effect/img/cats-effect-logo.svg" alt="Cats Effect" width="66" height="58"/></a><div><h5>Docs</h5><a href="/cats-effect/docs/getting-started">Getting Started</a><a href="/cats-effect/docs/tutorial">Tutorial</a><a href="/cats-effect/docs/typeclasses">Typeclasses</a><a href="/cats-effect/docs/schedulers">Schedulers</a></div><div><h5>Community</h5><a target="_blank" href="https://typelevel.org/blog/">Blog</a><a target="_blank" href="https://discord.gg/HmPs7rAtEY">Discord</a></div><div><h5>More</h5><a class="github-button" href="https://github.com/typelevel/cats-effect" data-icon="octicon-star" data-count-href="/typelevel/cats-effect/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a><div class="social"><a href="https://twitter.com/typelevel" class="twitter-follow-button">Follow @typelevel</a></div></div></section><section class="copyright">Copyright (c) 2017-2022 Typelevel</section></footer></div><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script></body></html>